import{_ as Ue,r as v,c as Ae,w as Ve,o as Ge,a as q,b as K,d as a,f as D,F as He,h as je,n as B,g as w,t as we}from"./index-C5I6P_8s.js";const Ie={class:"puzzles-page"},Xe={class:"puzzle-content"},Ye={class:"puzzle-container"},Ze={class:"puzzle-layout"},Je={class:"chess-container"},es={class:"board-wrapper"},ss={class:"chess-board",ref:"chessBoard"},ts=["onClick"],ls=["data-piece"],os={key:1,class:"move-indicator"},as={class:"controls-card"},ns={key:0,class:"status-message"},us={class:"controls-sidebar"},is={class:"puzzle-info-card"},rs={class:"puzzle-title"},cs={class:"control-buttons-vertical"},vs={key:0,class:"promotion-dialog-overlay"},fs={class:"promotion-dialog"},ps={class:"promotion-pieces"},ds={key:1,class:"game-end-overlay"},hs={class:"game-end-dialog"},ks={__name:"Puzzles",setup(gs){const C=v(0),G=v(0),z=v(null),f=v(""),p=v(""),d=v(""),b=v("white"),N=v([]),oe=v([]),M=v(!0),H=v(!1),j=v(!1),I=v(!1),ae=v(!1),X=v(null),m=v(null),x=v(!1),F=v(null),P=v(null),R=v(0),Q=v(!1),Ce=v(""),ze=()=>{R.value=0},Me=(s,e)=>{const t=O.value;if(!t||!t.solution||t.solution.length===0)return;const l=t.solution;if(R.value>=l.length)return;const o=l[R.value];if(xe(s,e)===o)if(f.value="✅ Correct move!",p.value="alert-success",d.value="fas fa-check-circle",R.value++,R.value<l.length){const i=l[R.value],[u,c]=Fe(i);setTimeout(()=>{ge(u,c,!0),R.value++,b.value="white",R.value>=l.length&&setTimeout(()=>{te()},500)},400)}else Ce.value="🎉 Puzzle Complete! Great job!",Q.value=!0,M.value=!1;else setTimeout(()=>{se(),f.value="❌ Wrong move! ",p.value="alert-danger",d.value="fas fa-ban"},500)},Pe=()=>{Q.value=!1,te()},g=v({whiteKingMoved:!1,blackKingMoved:!1,whiteKingsideRookMoved:!1,whiteQueensideRookMoved:!1,blackKingsideRookMoved:!1,blackQueensideRookMoved:!1}),S=v([]),r=v([]),O=Ae(()=>!S.value||S.value.length===0?null:S.value[C.value]||S.value[0]),Re=s=>{const e=[],t=s.split(" ")[0].split("/");for(let l of t)for(let o of l)if(isNaN(o))e.push(o);else for(let n=0;n<parseInt(o);n++)e.push("");return e},W=()=>{const s=O.value;if(s){r.value=[];for(let e=0;e<64;e++)r.value.push({piece:s.board[e]||null,selected:!1});b.value="white",N.value=[],oe.value=[],M.value=!0,H.value=!1,j.value=!1,I.value=!1,ae.value=!1,X.value=null,m.value=null,x.value=!1,F.value=null,P.value=null,g.value={whiteKingMoved:!1,blackKingMoved:!1,whiteKingsideRookMoved:!1,whiteQueensideRookMoved:!1,blackKingsideRookMoved:!1,blackQueensideRookMoved:!1},ze()}};Ve(S,s=>{s.length>0&&W()});const Se=async()=>{const l=(await(await fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vQyFaAasaUsySp8rSfkT_zmqo4fKdxYc8Fi7WZeIbpRvRGT2aiNM5rNepOy9rWHjzL0xvzNUz2gfrXo/pub?output=csv")).text()).split(`
`).map(n=>n.split(",")),o=l[0];S.value=l.slice(1).map(n=>{let i={};return o.forEach((u,c)=>i[u.trim()]=n[c]?.trim()),i.board=Re(i.fen),i.solution=i.solution?.split(" ").map(u=>u.trim()),i})},T=s=>s&&s===s.toUpperCase(),Y=s=>s&&s===s.toLowerCase(),ne=s=>s?b.value==="white"?T(s):Y(s):!1,E=s=>{const e=Math.floor(s/8),t=s%8;return{row:e,col:t}},h=(s,e)=>s<0||s>7||e<0||e>7?-1:s*8+e,_=s=>r.value[s]&&r.value[s].piece!==null,U=(s,e)=>{const t=r.value[s]?.piece;return t?e?Y(t):T(t):!1},ue=(s,e)=>{const t=r.value[s]?.piece;return t?e?T(t):Y(t):!1},ye=s=>{const e=s?"K":"k";for(let t=0;t<64;t++)if(r.value[t]?.piece===e)return t;return-1},ie=(s,e)=>{for(let t=0;t<64;t++){const l=r.value[t]?.piece;if(!l)continue;const o=T(l);if(o!==e)continue;const{row:n,col:i}=E(t);let u=[];switch(l.toLowerCase()){case"p":u.push(...Ke(n,i,o));break;case"r":u.push(...Z(n,i,o));break;case"n":u.push(...fe(n,i,o));break;case"b":u.push(...J(n,i,o));break;case"q":u.push(...pe(n,i,o));break;case"k":u.push(...de(n,i,o));break}if(u.some(c=>c.index===s))return!0}return!1},A=s=>{const e=ye(s);return e===-1?!1:ie(e,!s)},qe=s=>{for(let e=0;e<64;e++){const t=r.value[e]?.piece;if(!t||T(t)!==s)continue;if(he(e).length>0)return!0}return!1},re=()=>{const s=A(!0),e=A(!1);H.value=s,j.value=e;const t=b.value==="white";qe(t)?s?(f.value+=" - White King in Check! ♔",p.value="alert-warning",d.value="fas fa-exclamation-triangle"):e&&(f.value+=" - Black King in Check! ♚",p.value="alert-warning",d.value="fas fa-exclamation-triangle"):t&&s?(I.value=!0,X.value="black",M.value=!1,f.value="♚ Checkmate! Black wins!",p.value="alert-danger",d.value="fas fa-trophy"):!t&&e?(I.value=!0,X.value="white",M.value=!1,f.value="♔ Checkmate! White wins!",p.value="alert-danger",d.value="fas fa-trophy"):(ae.value=!0,M.value=!1,f.value="🤝 Stalemate! Draw!",p.value="alert-warning",d.value="fas fa-handshake")},ce=(s,e,t)=>{const l=r.value[s]?.piece,o=r.value[e]?.piece;r.value[s].piece=null,r.value[e].piece=l;const n=A(t);return r.value[s].piece=l,r.value[e].piece=o,n},Ke=(s,e,t)=>{const l=[],o=t?-1:1,n=h(s+o,e-1);n!==-1&&l.push({index:n});const i=h(s+o,e+1);return i!==-1&&l.push({index:i}),l},ve=(s,e,t)=>{const{row:l,col:o}=E(s);if(e){if(g.value.whiteKingMoved||t&&g.value.whiteKingsideRookMoved||!t&&g.value.whiteQueensideRookMoved)return!1}else if(g.value.blackKingMoved||t&&g.value.blackKingsideRookMoved||!t&&g.value.blackQueensideRookMoved)return!1;if(l!==(e?7:0)||o!==4)return!1;const u=h(l,t?7:0);if(r.value[u]?.piece!==(e?"R":"r"))return!1;const y=t?5:1,_e=t?6:3;for(let L=y;L<=_e;L++){const le=h(l,L);if(_(le))return!1}if(A(e))return!1;const De=4,Oe=t?6:2,me=t?1:-1;for(let L=De;L!==Oe+me;L+=me){const le=h(l,L);if(ie(le,!e))return!1}return!0},Be=(s,e)=>{const t=[],{row:l}=E(s);return ve(s,e,!0)&&t.push({index:h(l,6),isCastling:!0,isKingside:!0}),ve(s,e,!1)&&t.push({index:h(l,2),isCastling:!0,isKingside:!1}),t},Te=(s,e,t)=>{const l=[],o=t?-1:1,n=t?6:1,i=h(s+o,e);if(i!==-1&&!_(i)&&(l.push({index:i}),s===n)){const k=h(s+o*2,e);k!==-1&&!_(k)&&l.push({index:k,isDoublePawnMove:!0})}const u=h(s+o,e-1);u!==-1&&U(u,t)&&l.push({index:u});const c=h(s+o,e+1);if(c!==-1&&U(c,t)&&l.push({index:c}),m.value!==null){const k=Math.floor(m.value/8),y=m.value%8;s+o===k&&(e-1===y&&l.push({index:m.value,isEnPassant:!0}),e+1===y&&l.push({index:m.value,isEnPassant:!0}))}return l},Z=(s,e,t)=>{const l=[],o=[[0,1],[0,-1],[1,0],[-1,0]];for(const[n,i]of o)for(let u=1;u<8;u++){const c=h(s+n*u,e+i*u);if(c===-1)break;if(!_(c))l.push({index:c});else{U(c,t)&&l.push({index:c});break}}return l},fe=(s,e,t)=>{const l=[],o=[[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]];for(const[n,i]of o){const u=h(s+n,e+i);u!==-1&&!ue(u,t)&&l.push({index:u})}return l},J=(s,e,t)=>{const l=[],o=[[1,1],[1,-1],[-1,1],[-1,-1]];for(const[n,i]of o)for(let u=1;u<8;u++){const c=h(s+n*u,e+i*u);if(c===-1)break;if(!_(c))l.push({index:c});else{U(c,t)&&l.push({index:c});break}}return l},pe=(s,e,t)=>[...Z(s,e,t),...J(s,e,t)],de=(s,e,t)=>{const l=[],o=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];for(const[n,i]of o){const u=h(s+n,e+i);u!==-1&&!ue(u,t)&&l.push({index:u})}return l},he=s=>{const e=r.value[s]?.piece;if(!e)return[];const{row:t,col:l}=E(s),o=T(e);let n=[];switch(e.toLowerCase()){case"p":n.push(...Te(t,l,o));break;case"r":n.push(...Z(t,l,o));break;case"n":n.push(...fe(t,l,o));break;case"b":n.push(...J(t,l,o));break;case"q":n.push(...pe(t,l,o));break;case"k":n.push(...de(t,l,o)),n.push(...Be(s,o));break}return n.filter(u=>!ce(s,u.index,o)).filter(u=>u.index>=0&&u.index<64)},ke=s=>{const e=he(s);N.value=e},ee=s=>N.value.some(e=>e.index===s),$e=s=>{const e=Math.floor(s/8),t=s%8,l=(e+t)%2===0;let o=["chess-square"];o.push(l?"light-square":"dark-square"),r.value[s].selected&&o.push("selected-square"),ee(s)&&o.push("valid-move-square");const n=r.value[s]?.piece;return(n==="K"&&H.value||n==="k"&&j.value)&&o.push("king-in-check"),o},Le=s=>s?s===s.toUpperCase()?"white-piece":"black-piece":"",Ne=(s,e)=>{e==="K"?g.value.whiteKingMoved=!0:e==="k"?g.value.blackKingMoved=!0:e==="R"?(s===63&&(g.value.whiteKingsideRookMoved=!0),s===56&&(g.value.whiteQueensideRookMoved=!0)):e==="r"&&(s===7&&(g.value.blackKingsideRookMoved=!0),s===0&&(g.value.blackQueensideRookMoved=!0))},xe=(s,e)=>{const t="abcdefgh",l=Math.floor(s/8),o=s%8,n=Math.floor(e/8),i=e%8;return`${t[o]}${8-l}${t[i]}${8-n}`},Fe=s=>{const e="abcdefgh",t=e.indexOf(s[0]),l=8-parseInt(s[1]),o=e.indexOf(s[2]),n=8-parseInt(s[3]);return[l*8+t,n*8+o]};v(0),v([]);const ge=(s,e,t=!1)=>{const l=r.value[s]?.piece;if(!l)return;const o=r.value[e]?.piece,n=T(l);if(!t&&ce(s,e,n)){f.value="⚠️ Illegal move! This would leave your king in check.",p.value="alert-danger",d.value="fas fa-ban",$();return}Ne(s,l),m.value,m.value=null;const i=N.value.find(c=>c.index===e);if(i?.isEnPassant){const k=e+(n?1:-1)*8;r.value[k].piece=null}if(i?.isCastling){const{row:c}=E(s);if(i.isKingside){const k=h(c,7),y=h(c,5);r.value[y].piece=r.value[k].piece,r.value[k].piece=null}else{const k=h(c,0),y=h(c,3);r.value[y].piece=r.value[k].piece,r.value[k].piece=null}}if(r.value[e].piece=l,r.value[s].piece=null,l.toLowerCase()==="p"&&i?.isDoublePawnMove){const c=n?1:-1;m.value=e+c*8}const u=Math.floor(e/8);if(!t&&l.toLowerCase()==="p"&&(u===0||u===7)){x.value=!0,F.value=e,P.value=n,M.value=!1,f.value="👑 Choose a piece for promotion!",p.value="alert-info",d.value="fas fa-crown";return}oe.value.push({from:s,to:e,piece:l,captured:o,turn:b.value,castling:i?.isCastling||!1,enPassant:i?.isEnPassant||!1}),$(),t||(b.value=b.value==="white"?"black":"white"),re(),t||Me(s,e)},Qe=s=>{if(!M.value||x.value)return;const e=r.value[s];z.value===null?e.piece&&ne(e.piece)?(z.value=s,e.selected=!0,ke(s),f.value=`${b.value==="white"?"White":"Black"} to move`,p.value="alert-info",d.value="fas fa-chess"):e.piece&&(f.value=`It's ${b.value}'s turn!`,p.value="alert-warning",d.value="fas fa-exclamation-triangle"):z.value===s?$():ee(s)?ge(z.value,s):e.piece&&ne(e.piece)?($(),z.value=s,e.selected=!0,ke(s)):(f.value="Invalid move! Try again.",p.value="alert-danger",d.value="fas fa-times")},$=()=>{z.value!==null&&(r.value[z.value].selected=!1),z.value=null,N.value=[]},se=()=>{$(),W(),f.value="Puzzle reset! White to move.",p.value="alert-info",d.value="fas fa-undo",Q.value=!1},We=()=>{const s=O.value.hints;f.value=`Hint: ${s}`,p.value="alert-info",d.value="fas fa-lightbulb"},Ee=()=>{const s=O.value.sol;f.value=`solution: ${s}`,p.value="alert-info",d.value="fas fa-lightbulb"},te=()=>{C.value<S.value.length-1?C.value++:C.value=0,$(),W(),f.value="New puzzle loaded! White to move.",p.value="alert-success",d.value="fas fa-puzzle-piece",G.value++},be=()=>{C.value>0?C.value--:C.value=S.value.length-1,$(),W(),f.value="Previous puzzle loaded! White to move.",p.value="alert-info",d.value="fas fa-puzzle-piece",G.value>0&&G.value--},V=s=>{if(F.value===null)return;const e=P.value?s.toUpperCase():s.toLowerCase();r.value[F.value].piece=e,x.value=!1,M.value=!0,f.value=`Pawn promoted to ${s.toUpperCase()}! 👑`,p.value="alert-success",d.value="fas fa-crown",F.value=null,P.value=null,b.value=b.value==="white"?"black":"white",re()};return Ge(()=>{Se(),document.title="IISER-TVM Chess Club - Puzzles",W(),f.value="White to move. Select a piece to start!",p.value="alert-info",d.value="fas fa-chess"}),(s,e)=>(K(),q("div",Ie,[a("section",Xe,[a("div",Ye,[a("div",Ze,[a("div",Je,[a("div",es,[a("div",ss,[(K(!0),q(He,null,je(r.value,(t,l)=>(K(),q("div",{key:l,class:B($e(l)),onClick:o=>Qe(l)},[t.piece?(K(),q("div",{key:0,class:B([Le(t.piece),"chess-piece"]),"data-piece":t.piece},null,10,ls)):D("",!0),ee(l)?(K(),q("div",os)):D("",!0)],10,ts))),128))],512)]),a("div",as,[f.value?(K(),q("div",ns,[a("div",{class:B([p.value,"alert"])},[a("i",{class:B([d.value,"me-2"])},null,2),w(we(f.value),1)],2)])):D("",!0),a("div",us,[a("div",is,[a("h3",rs,[e[6]||(e[6]=a("i",{class:"fas fa-puzzle-piece me-2"},null,-1)),w("Puzzle #"+we(C.value+1),1)])]),e[12]||(e[12]=a("h4",{class:"controls-title"},"Controls",-1)),a("div",cs,[a("button",{class:"btn btn-control btn-reset",onClick:se},[...e[7]||(e[7]=[a("i",{class:"fas fa-undo me-2"},null,-1),w("Reset ",-1)])]),a("button",{class:"btn btn-control btn-hint",onClick:We},[...e[8]||(e[8]=[a("i",{class:"fas fa-lightbulb me-2"},null,-1),w("Hint ",-1)])]),a("button",{class:"btn btn-control btn-sol",onClick:Ee},[...e[9]||(e[9]=[a("i",{class:"fas fa-check me-2"},null,-1),w("Check Solution ",-1)])]),a("button",{class:"btn btn-control btn-next",onClick:te},[...e[10]||(e[10]=[a("i",{class:"fas fa-arrow-right me-2"},null,-1),w("Next Puzzle ",-1)])]),a("button",{class:"btn btn-control btn-back",onClick:e[0]||(e[0]=(...t)=>be&&be(...t))},[...e[11]||(e[11]=[a("i",{class:"fas fa-arrow-left me-2"},null,-1),w("Back ",-1)])])])])])])])]),x.value?(K(),q("div",vs,[a("div",fs,[e[17]||(e[17]=a("h3",{class:"text-center"},"Choose Promotion Piece",-1)),a("div",ps,[a("button",{onClick:e[1]||(e[1]=t=>V("q")),class:"promotion-btn"},[a("div",{class:B([P.value?"white-piece":"black-piece","promotion-piece"])},"♕",2),e[13]||(e[13]=a("span",null,"Queen",-1))]),a("button",{onClick:e[2]||(e[2]=t=>V("r")),class:"promotion-btn"},[a("div",{class:B([P.value?"white-piece":"black-piece","promotion-piece"])},"♖",2),e[14]||(e[14]=a("span",null,"Rook",-1))]),a("button",{onClick:e[3]||(e[3]=t=>V("b")),class:"promotion-btn"},[a("div",{class:B([P.value?"white-piece":"black-piece","promotion-piece"])},"♗",2),e[15]||(e[15]=a("span",null,"Bishop",-1))]),a("button",{onClick:e[4]||(e[4]=t=>V("n")),class:"promotion-btn"},[a("div",{class:B([P.value?"white-piece":"black-piece","promotion-piece"])},"♘",2),e[16]||(e[16]=a("span",null,"Knight",-1))])])])])):D("",!0),Q.value?(K(),q("div",ds,[a("div",hs,[a("button",{class:"popup-close-btn",onClick:e[5]||(e[5]=t=>Q.value=!1)},[...e[18]||(e[18]=[a("i",{class:"fas fa-times"},null,-1)])]),e[21]||(e[21]=a("div",{class:"game-end-icon"},[a("i",{class:"fas fa-trophy"})],-1)),e[22]||(e[22]=a("h2",{class:"game-end-title"},"Puzzle Complete!",-1)),e[23]||(e[23]=a("p",{class:"game-end-subtitle"},"🎉 Great job solving the puzzle!",-1)),a("div",{class:"game-end-buttons"},[a("button",{onClick:se,class:"btn btn-light btn-lg"},[...e[19]||(e[19]=[a("i",{class:"fas fa-redo me-2"},null,-1),w("Play Again ",-1)])]),a("button",{onClick:Pe,class:"btn btn-warning btn-lg"},[...e[20]||(e[20]=[a("i",{class:"fas fa-arrow-right me-2"},null,-1),w("Next Puzzle ",-1)])])])])])):D("",!0)])]))}},ms=Ue(ks,[["__scopeId","data-v-29243bc9"]]);export{ms as default};
